//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop
#include <math.h>

#include "FragmentUnit.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma link "Chart"
#pragma link "TeEngine"
#pragma link "TeeProcs"
#pragma link "Series"
#pragma resource "*.dfm"
TFragmentForm *FragmentForm;
//---------------------------------------------------------------------------
__fastcall TFragmentForm::TFragmentForm(TComponent* Owner) : TForm(Owner)  { }
//---------------------------------------------------------------------------
void __fastcall TFragmentForm::FormActivate(TObject *Sender)
{
	bool  bX;
	float Way0, X;
	Series1->Clear();
	Series2->Clear();
	df = fopen(FragmentName.c_str(), "rb");
	fread(&DT, sizeof(DT_STRUCT), 1, df);
	fCount = 0;
	if (DT.Way == 0) {
		Way0 = 0;
		bX   = true;
	}	else {
		Way0 = DT.Way;
		bX   = false;
	}
	while (!feof(df)) {
		try {
			fread(&DT, sizeof(DT_STRUCT), 1, df);
			if (fCount == 0) Way0 = DT.Way;
			fCount++;
			(bX) ? X = fCount : X = DT.Way - Way0;
			Series1->AddXY(X, sqrt(DT.DT_DATA[1]*DT.DT_DATA[1] + DT.DT_DATA[2]*DT.DT_DATA[2] + DT.DT_DATA[0]*DT.DT_DATA[0]));
			Series2->AddXY(X, sqrt(DT.DT_DATA[4]*DT.DT_DATA[4] + DT.DT_DATA[5]*DT.DT_DATA[5] + DT.DT_DATA[3]*DT.DT_DATA[3]));
		} catch (...) {
			ShowMessage("Ошибка чтения файла. Запись " + IntToStr((int)fCount));
			break;
		}
	}
	fclose(df);
}
//---------------------------------------------------------------------------
void __fastcall TFragmentForm::Init(AnsiString FName)
{
	FragmentName = FName;
}
//---------------------------------------------------------------------------
void __fastcall TFragmentForm::FormClose(TObject *Sender, TCloseAction &Action)
{
	FragmentForm = NULL;
	Action = caFree;
}
//---------------------------------------------------------------------------
void __fastcall TFragmentForm::Chart1DblClick(TObject *Sender)
{
	Close();
}
//---------------------------------------------------------------------------


