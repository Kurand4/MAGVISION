//---------------------------------------------------------------------------

#ifndef SUnitH
#define SUnitH
//---------------------------------------------------------------------------
#include <StdIO.h>
#include <Classes.hpp>
#include <Controls.hpp>
#include <StdCtrls.hpp>
#include <Forms.hpp>
#include <ExtCtrls.hpp>
#include "Chart.hpp"
#include "TeEngine.hpp"
#include "TeeProcs.hpp"
#include <Dialogs.hpp>
#include "Series.hpp"
#include <CmAdmCtl.hpp>
#include <OleServer.hpp>
#include "ShellApi.h"
#include "Registry.hpp"

//---------------------------------------------------------------------------
class TSForm : public TForm
{
__published:	// IDE-managed Components
	TTimer *Timer1;
	TPanel *Panel1;
	TSplitter *Splitter1;
	TPanel *Panel2;
	TPanel *Panel3;
	TSplitter *Splitter2;
	TPanel *Panel4;
	TSplitter *Splitter3;
	TPanel *Panel5;
	TListBox *COMListBox;
	TLabel *Label1;
	TRadioGroup *RadioGroup_XAxes;
	TRadioGroup *RG_MarkerStep;
	TButton *CloseButton;
	TComboBox *CB_StartBox;
	TLabel *Label2;
	TGroupBox *GroupBox1;
	TMemo *KMDMemo;
	TGroupBox *GroupBox2;
	TMemo *GPSMemo;
	TComboBox *CBox_KMDBth;
	TButton *KMDBthButton;
	TLabel *Label3;
	TComboBox *CBox_GPSBth;
	TButton *GPSBthButton;
	TLabel *Label4;
	TRadioGroup *RG_PlotType;
	TButton *ParamBluetoothButton;
	TButton *AddBluetoothButton;
	TSplitter *Splitter4;
	TPanel *Panel6;
	TGroupBox *GroupBox7;
	TButton *ButtonSelectFragment;
	TCheckBox *CB_FragmSearch;
	TOpenDialog *OpenDialog1;
	TRadioGroup *RG_AutoRestart;
	TComboBox *CB_DevNum;
	TLabel *Label5;
	TChart *Chart1;
	TFastLineSeries *Series1;
	TFastLineSeries *Series2;
	void __fastcall CloseButtonClick(TObject *Sender);
	void __fastcall RadioGroup_XAxesClick(TObject *Sender);
	void __fastcall KMDBthButtonClick(TObject *Sender);
	void __fastcall CBox_KMDBthCloseUp(TObject *Sender);
	void __fastcall COMListBoxDblClick(TObject *Sender);
	void __fastcall GPSBthButtonClick(TObject *Sender);
	void __fastcall Timer1Timer(TObject *Sender);
	void __fastcall RG_MarkerStepClick(TObject *Sender);
	void __fastcall CB_StartBoxKeyUp(TObject *Sender, WORD &Key, TShiftState Shift);
	void __fastcall RG_PlotTypeClick(TObject *Sender);
	void __fastcall FormHide(TObject *Sender);
	void __fastcall FormCreate(TObject *Sender);
	void __fastcall ParamBluetoothButtonClick(TObject *Sender);
	void __fastcall AddBluetoothButtonClick(TObject *Sender);
	void __fastcall FormShow(TObject *Sender);
	void __fastcall ButtonSelectFragmentClick(TObject *Sender);
	void __fastcall RG_AutoRestartClick(TObject *Sender);
	void __fastcall CB_DevNumCloseUp(TObject *Sender);
	void __fastcall CB_DevNumChange(TObject *Sender);
private:	// User declarations
	AnsiString	BthKMDname, BthGPSname, InfoStr;
	AnsiString  sComPort;
	struct DT_STRUCT {
		unsigned short	Metka;              //
		TTime 	    DT_TIME;
		float     	DT_DATA[6];      //
		float      	AV_DATA[6];      //
		float       Way;
		float       Spd;
		float       Depth;
		double      Lat;
		double      Lng;
		bool				StdCommentType[5];    // standard comments: 0 - Izol, 1 - KIP, 2 - cross, 3 - road, 4 - turn
	} DT;
	TDCB		lpDCB;
	HWND	h;
	FILE * df;
	char 	  buf[256];
	DWORD   BytesRead;
	int			GPSspeed;
	TRegistry		* Reg;
	TStringList * List;
	int		  m_lLastError;
	int 		MAXPOINT;    // кол. точек по оси х на графиках
	int 		MarkerStep, StartWay;
	__int64     AUTORESTART;
	void 		ClearAllBox();
	void 		SetMaxPoint();
	void 		GetInfFile();
	bool 		__fastcall TestKMD(AnsiString s);
	void 		__fastcall TestGPS(AnsiString s);
	void 		SetMarkerStep(int MarkerStep, TRadioGroup *RG);
	void 		SetAutoRestart();
public:		// User declarations
	AnsiString  FragmentName;
	AnsiString  sDevNum;         // номер прибора
	HANDLE  GPSport, KMDport;
	void 		SaveInfFile();
	bool    KMDBthflag, GPSBthflag;
	int			fCount;   // number of fragment points
	double	FrLat, FrLng;
	int 		iOutputType;           // 0 - V   1 - VA  2 - both
	__fastcall TSForm(TComponent* Owner);
	String 	LeadSpace(int k, String s);
	String 	LeadZero(int k, int dig);
};
//---------------------------------------------------------------------------
extern PACKAGE TSForm *SForm;
//---------------------------------------------------------------------------
#endif
